# Exercise3: App Service に OIDC 認証設定

## 【目次】

![](images/ex01-0000-sqldb-create.png)

1. [IDプロバイダーの追加](#idプロバイダーの追加)
1. [アクセス制限の有効化](#アクセス制限の有効化)
1. [アクセス許可させたいユーザーを設定](#アクセス許可させたいユーザーを設定)
1. [動作確認](#動作確認)


## IDプロバイダーの追加

1. App Service を開き、 [設定]-[認証] を開く

1. 「IDプロバイダーを追加」を開く

1. IDプロバイダーを追加

    1. 基本
        * IDプロバイダー: `Microsoft`
        * テナントの種類: `従業員`
        * アプリ登録の種類: `アプリの登録を新規作成`
        * 名前: （任意）
        * サポートされているアカウントの種類: `現在のテナント`
        * App Service 認証設定: `認証が必要`
        * 認証されていない要求: `HTTP 302 (IDプロバイダーにリダイレクト)`

    1. アクセス許可

        デフォルトのまま

        * `User.Read`


## アクセス制限の有効化

1. Azure AD を開き、 [管理]-[エンタープライズアプリケーション]を開く

1. 前の手順で作成したアプリを開く

    （デフォルト名で作成した場合、 App Service と同じ名前のアプリを開く）

1. [管理]-[プロパティ]を開く

1. 「割当が必要ですか」を `はい` に設定して「保存」


## アクセス許可させたいユーザーを設定

1. 前の手順の続き（エンタープライズアプリケーションの画面）で
   [管理]-[ユーザーとグループ]を開く

1. 「ユーザーまたはグループの追加」を開く

1. 「ユーザーとグループ」に自分自身のアカウントを追加して「割り当て」

    (*) ハンズオンではグローバル管理者のユーザーを追加


## 動作確認

1. App Service を開き、「概要」にある「既定のドメイン」を確認

1. 新しくブラウザを立ち上げて「既定のドメイン」のURLにアクセス

1. 認証が要求されるので、自分自身のアカウントでログイン

1. アクセス許可の確認があるので「承諾」

1. アプリが開けることを確認


# 次の Exercise へ

* [WAFの配置](exercise04.md)
