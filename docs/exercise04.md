# Exercise4: WAFの配置

## 【目次】

![](images/ex01-0000-sqldb-create.png)

1. [Application Gateway のデプロイ]()
1. [動作確認]()


## Application Gateway のデプロイ

1. Azureポータルから「アプリケーション ゲートウェイ」を検索、開く

1. 「作成」

1. アプリケーションゲートウェイの作成

    1. 基本

        * ゲートウェイ名: （任意）
        * 地域: `Japan East`
        * レベル: `WAF V2`
        * 自動スケール: `はい`
        * 最小インスタンス数: `0`
        * 最大インスタンス数: `10`
        * 可用性ゾーン：`なし`
        * HTTP2: `有効`
        * WAFポリシー: （新規作成。名前は任意、ボット保護を追加）
        * 仮想ネットワーク: （事前準備で作成済みの仮想ネットワーク）
        * サブネット: `gateway-snet`

    1. フロントエンド

        * フロントエンドIP: `パブリック`
        * パブリックIPアドレス: （新規追加。名前は任意）

    1. バックエンド

        * バックエンドプール
            * 名前: （任意）（例: `todo-app-pool` ）
            * バックエンドターゲット: 

                |ターゲットの種類|ターゲット|
                |---|---|
                | `App Service` | （作成済みの App Service） |

    1. 構成

        * ルーティング規則
            * ルール名: （任意）
            * 優先度: `100`
            * リスナー
                * リスナー名: （任意）（例: `http-listener` ）
                * フロントエンドIP: `パブリック`
                * プロトコル: `HTTP`
                * ポート: `80`
                * リスナーの種類: `Basic`
            * バックエンドターゲット
                * ターゲットの種類: `バックエンドプール`
                * バックエンドターゲット: （前のバックエンドのページで作成したターゲット）
                * バックエンド設定: （新規追加）
                    * バックエンド設定名: （任意）（例: `todo-app-config` ）
                    * バックエンドプロトコル: `HTTPS`
                    * バックエンドポート: `443`
                    * バックエンドサーバーの証明書は既知のCAによって発行: `はい`
                    * Cookieベースアフィニティ: `無効化`
                    * 接続のドレイン: `無効化`
                    * 要求のタイムアウト: `20`
                    * 新しいホスト名でオーバーライド: `はい`
                    * ホスト名をオーバーライド: `バックエンドターゲットからホスト名を選択`
                    * カスタムプローブを作成: `はい`

    1. タグ

        特に指定なし

    1. 確認および作成

        作成内容確認して「作成」



## 動作確認

1. 作成した Application Gateway を開き、「概要」にある「フロントエンドパブリックIPアドレス」を確認

1. 新しくブラウザを立ち上げて確認した「フロントエンドパブリックIPアドレス」を開く


# 次の Exercise へ

* [ネットワークの制限](exercise05.md)
