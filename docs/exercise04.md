# Exercise4: WAFの配置

## 【目次】

![](images/ex01-0000-sqldb-create.png)

1. [Front Door のデプロイ]()
1. [動作確認]()


## Front Door のデプロイ

1. Azureポータルから「Front Door」を検索、開く

1. 「作成」

1. 「Azure Front Door」の「カスタム作成」を選択して「続行」

1. Front Door プロファイルの作成

    1. 基本

        * 名前: （任意）
        * レベル: `Standard`

    1. シークレット

        何も指定しない

    1. エンドポイント

        「エンドポイントの追加」を選択して以下の内容でエンドポイントを追加

        * エンドポイント名: （任意）
        * 状態: `有効`
        
        いったんここで「追加」
        続けて以下の設定（「ルート」の追加と、「セキュリティポリシー」の追加）をしていく

        1. ルートの追加
            * 名前: （任意）
            * ドメイン: （デフォルトまま）
            * 一致するパターン: `/*`
            * 受け入れ済みのプロトコル: `HTTP と HTTPS`
            * リダイレクト: `リダイレクトする`
            * 配信元グループ（ `追加する` から以下の内容を追加）
                * 名前: （任意）
                * 配信元:
                    * 名前: （任意）
                    * 配信元の種類: `App Services`
                    * ホスト名: （作成済みの App Service）
                    * 配信元のホストヘッダー: （ホスト名に同じ）
                    * 証明書のサブジェクト名の検証: `有効`
                    * HTTPポート: `80` 
                    * HTTPSポート: `443`
                    * 優先順位: `1`
                    * 状態: `有効`
                * 正常性プローブ
                    * 状態: `有効`
                    * パス: `/healthz`
                    * プロトコル: `HTTPS`
                    * メソッド: `GET`
                    * 間隔: `100`
                * 負荷分散
                    * サンプルサイズ: `4`
                    * 成功サンプル: `3`
                    * 待機時間感度: `50`
            * 配信元のパス: （空欄）
            * 転送プロトコル: `受信した要求を一致させる`
            * キャッシュ: `無効` （チェックを入れない）
        
        1. セキュリティポリシーの追加
            * 名前: （任意）
            * ドメイン: （Fornt Door のエンドポイントを選択）
            * WAFポリシー: （任意）

    1. タグ

        指定なし

    1. 確認および作成

        内容を確認して「作成」


## 動作確認

1. Azure ポータルから Front Door を開き、[概要] にある「エンドポイントのホスト名」を確認

1. 新規ブラウザを開いて確認したエンドポイントへアクセス

1. App Service へアクセスできることを確認


# 次の Exercise へ

* [ネットワークの制限](exercise05.md)
